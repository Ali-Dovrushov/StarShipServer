(this["webpackJsonpreact-chat"]=this["webpackJsonpreact-chat"]||[]).push([[0],{21:function(e,t,n){},22:function(e,t,n){},29:function(e,t,n){},30:function(e,t,n){"use strict";n.r(t);var s=n(1),r=n(0),a=n.n(r),o=n(6),c=n.n(o),u=(n(21),n(4)),i=n(7),l=n(10),h=n(9);n(22);var g=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(u.a)(this,n),(s=t.call(this,e)).handleSubmit=function(e){e.preventDefault(),function(e){try{return fetch("http://localhost:3002/logIn",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){return e.json()}))}catch(t){console.log("ERROR",t)}}({user:s.state.login}).then((function(e){e&&(0,s.props.saveCurrentUser)(s.state.login)})).catch((function(){return alert("This user is already exist")}))},s.handleInput=function(e){s.setState({login:e.target.value})},s.state={login:null},s}return Object(i.a)(n,[{key:"render",value:function(){var e=this.handleSubmit,t=this.handleInput;return Object(s.jsx)("div",{className:"root__auth-container",children:Object(s.jsxs)("form",{onSubmit:e,className:"auth-container__auth-form",children:[Object(s.jsx)("span",{children:"Authorization",className:"auth-form__form-name"}),Object(s.jsx)("input",{name:"login",required:!0,onChange:t,minlength:"4",className:"auth-form__login-input",placeholder:"Please Type userName"}),Object(s.jsx)("button",{className:"auth-form__submit-button",children:"Sign in"})]})})}}]),n}(a.a.PureComponent),d=Object.defineProperties({},{LOG_IN:{value:"log_in",writable:!1},LOG_OUT:{value:"log_out",writable:!1},SAVE_CURRENT_MESSAGE:{value:"save_current_message",writable:!1}}),f=function(e){return e.login.currentUser},O=function(e){return e.login.isLoged},m=n(2),b=Object(m.b)((function(e){return{currentUserName:f(e),isUserLoged:O(e)}}),(function(e){return{saveCurrentUser:function(t){return e(function(e){return{type:d.LOG_IN,payload:e}}(t))}}}))(g),j=n(8),p=(n(29),function e(){var t=this;Object(u.a)(this,e),this.onOpen=function(){console.log("----WEBSOCKET CONNECTED---------")},this.onClose=function(){console.log("----WEBSOCKET DISCONNECTED---------")},this.getOnMessage=function(e){t._ws.onmessage=function(t){var n=t.data;e(JSON.parse(n))}},this.sendMessage=function(e){t._ws.send(JSON.stringify(e))},this._host=window.location.origin.replace(/^http/,"ws"),this._ws=new WebSocket(this._host),this._ws.onopen=this.onOpen.bind(this),this._ws.onclose=this.onClose.bind(this)}),_=function(e){return Object(s.jsxs)("li",{className:e.user===e.curUser?"chat-window__message current-user-message":"chat-window__message another-user-message",children:[Object(s.jsx)("span",{className:"message__user-name",children:e.user}),Object(s.jsx)("span",{className:"message__user-text",children:e.text})]})},v=a.a.memo(_),N=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(u.a)(this,n),(s=t.call(this,e)).getAllMessagesOnWS=function(e){s.setState({allMessages:e})},s.getMessages=function(){(function(){try{return fetch("http://localhost:3002/getAllMessages").then((function(e){return e.json()}))}catch(e){console.log("ERROR",e)}})().then((function(e){return s.setState({allMessages:e})})).catch((function(e){return console.log("it is not Array")}))},s.handleSubmit=function(e){e.preventDefault();var t=s.props,n=t.saveCurrentMessage,r={user:t.currentUserName,message:s.state.curMessage};n(r),s.ws.sendMessage(r),s.setState({curMessage:""})},s.handleInput=function(e){s.setState({curMessage:e.target.value})},s.logOut=function(){var e=s.props,t=e.logOutUser;!function(e){try{fetch("http://localhost:3002/logOut",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(t){console.log("ERROR",t)}}({user:e.currentUserName}),t()},s.state={curMessage:null,allMessages:[]},s.ws=new p,s.ws.getOnMessage(s.getAllMessagesOnWS.bind(Object(j.a)(s))),s.getMessages(),s}return Object(i.a)(n,[{key:"render",value:function(){var e=this.handleInput,t=this.logOut,n=this.handleSubmit,r=this.state.allMessages,a=this.props.currentUserName;return Object(s.jsxs)("div",{className:"root__main-container",children:[Object(s.jsx)("button",{onClick:t,className:"root__log-out-btn",children:"Log out"}),Object(s.jsxs)("div",{className:"main-container__chat-section",children:[Object(s.jsx)("ul",{className:"chat-section__chat-window",children:r.length?r.map((function(e,t){return Object(s.jsx)(v,{user:e.user,text:e.message,curUser:a},t)})):null}),Object(s.jsxs)("form",{onSubmit:n,className:"chat-window__chat-form",children:[Object(s.jsx)("input",{value:this.state.curMessage,onChange:e,className:"chat-form__message-input",required:!0}),Object(s.jsx)("button",{children:"Send",className:"chat-form__submit-button"})]})]})]})}}]),n}(a.a.PureComponent),S=function(e){return e.login.currentUser},w=function(e){return e.login.isLoged},y=function(e){return e.messenger},E=Object(m.b)((function(e){return{currentUserName:S(e),isUserLoged:w(e),currentMessageData:y(e)}}),(function(e){return{logOutUser:function(){return e({type:d.LOG_OUT,payload:t});var t},saveCurrentMessage:function(t){return e(function(e){return{type:d.SAVE_CURRENT_MESSAGE,payload:{user:e.user,message:e.message}}}(t))}}}))(N),x=function(e){var t=e.isUserLoged;return Object(s.jsx)(s.Fragment,{children:t?Object(s.jsx)(E,{}):Object(s.jsx)(b,{})})},U=a.a.memo(x),C=function(e){return e.login.isLoged},M=Object(m.b)((function(e){return{isUserLoged:C(e)}}))(U);var L=function(){return Object(s.jsx)(M,{})},T=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,31)).then((function(t){var n=t.getCLS,s=t.getFID,r=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),s(e),r(e),a(e),o(e)}))},R=n(5),A=n(3),I={currentUser:null,isLoged:!1},G={user:null,message:null},D=Object(R.b)({login:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d.LOG_IN:return Object(A.a)(Object(A.a)({},e),{},{currentUser:t.payload,isLoged:!0});case d.LOG_OUT:return Object(A.a)(Object(A.a)({},e),{},{currentUser:null,isLoged:!1});default:return e}},messenger:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d.SAVE_CURRENT_MESSAGE:return Object(A.a)(Object(A.a)({},e),{},{user:t.payload.user,message:t.payload.message});default:return e}}});!function(){var e=Object(R.c)(D);window.store=e,c.a.render(Object(s.jsx)(m.a,{store:e,children:Object(s.jsx)(L,{})}),document.getElementById("root"))}(),T()}},[[30,1,2]]]);
//# sourceMappingURL=main.c344fdcc.chunk.js.map